# **Документация проекта: Студия Подкастов с ИИ**

## 1. Обзор проекта

**Студия Подкастов с ИИ** — это передовое веб-приложение, предназначенное для автоматического создания коротких, атмосферных аудио-подкастов на заданную пользователем тему. Приложение генерирует полный пакет материалов: от уникального сценария и профессиональной озвучки несколькими голосами до набора визуальных материалов, включая фоновые изображения и обложки для YouTube.

**Основная цель** — предоставить авторам, маркетологам и энтузиастам мощный инструмент для быстрого создания качественного аудио-контента, минимизируя ручной труд и технические сложности.

**Ключевые возможности:**

*   **Генерация по теме:** Пользователь вводит тему, и ИИ создает всю структуру подкаста.
*   **Два режима источника знаний:**
    1.  **Google Search:** ИИ использует поиск Google для сбора актуальной информации (режим по умолчанию).
    2.  **База знаний:** Пользователь может вставить собственный текст, который будет единственным источником фактов для ИИ (режим исследования).
*   **Гибкие настройки стиля:**
    *   **Творческая свобода:** Генерация художественного, мистического рассказа в стиле Стивена Кинга/Лавкрафта.
    *   **Документальная точность:** Создание строгого, информативного подкаста на основе фактов.
*   **Автоматическая генерация контента:**
    *   Название, описание и SEO-ключи.
    *   Уникальные персонажи с описанием голосов.
    *   Детализированные промпты для генерации изображений.
    *   Полноценный сценарий, разбитый на главы.
*   **Многоголосая озвучка (TTS):** Синтез речи с использованием разных голосов для разных персонажей на основе их описаний.
*   **Визуальные материалы:** Генерация 10 тематических изображений и 3-х вариантов обложек для YouTube.
*   **Интерактивная студия:**
    *   Конвейерная генерация глав с возможностью паузы и возобновления.
    *   Прослушивание и повторная генерация каждой главы.
    *   Редактор обложек для YouTube с настройкой текста, шрифта, цвета и теней.
*   **История проектов:** Сохранение и загрузка предыдущих проектов из `localStorage`.
*   **Управление API-ключом:** Возможность использовать собственный Gemini API-ключ.

## 2. Используемые технологии

*   **Фронтенд:**
    *   **React 19:** Современная библиотека для создания пользовательских интерфейсов.
    *   **TypeScript:** Строгая типизация для повышения надежности и масштабируемости кода.
    *   **Tailwind CSS:** Утилитарный CSS-фреймворк для быстрой и адаптивной верстки.
*   **Искусственный интеллект (Google Gemini API):**
    *   **`gemini-2.5-pro`:** Используется для самых сложных задач — генерации концепции подкаста, сценариев, анализа текста в режиме исследования и работы с `googleSearch` tool.
    *   **`imagen-4.0-generate-001`:** Модель для генерации высококачественных изображений по текстовым промптам.
    *   **`gemini-2.5-flash-preview-tts`:** Модель для синтеза речи (Text-to-Speech), поддерживающая многоголосую озвучку.
*   **Браузерные API:**
    *   **Web Audio API:** Используется для обработки и сборки аудиофайлов в формате WAV.
    *   **Canvas API:** Применяется для клиентской генерации и редактирования обложек для YouTube.
    *   **LocalStorage API:** Для сохранения истории проектов и API-ключа пользователя.

## 3. Структура проекта

Проект организован в модульную структуру для удобства поддержки и разработки.

```
/
├── components/
│   ├── ApiKeyModal.tsx      # Модальное окно для ввода API-ключа.
│   ├── Icons.tsx            # Коллекция SVG-иконок в виде React-компонентов.
│   ├── Spinner.tsx          # Компонент индикатора загрузки.
│   └── ThumbnailEditor.tsx  # Редактор обложек на базе Canvas.
│
├── services/
│   ├── canvasUtils.ts       # Утилиты для отрисовки на Canvas (текст, тени, оверлей).
│   ├── imageService.ts      # Сервис для взаимодействия с Imagen и генерации обложек.
│   └── ttsService.ts        # Основной сервис для работы с Gemini (сценарии, TTS, сборка WAV).
│
├── App.tsx                  # Главный компонент приложения, управляющий состоянием и логикой.
├── index.html               # Точка входа в приложение.
├── index.tsx                # Инициализация React-приложения.
├── metadata.json            # Метаданные проекта.
└── types.ts                 # Определения TypeScript-типов для всего проекта.
```

## 4. Ключевые рабочие процессы

### 4.1. Начало работы

1.  **Ввод темы:** Пользователь вводит тему в основное поле ввода.
2.  **Настройка "Базы знаний":**
    *   Если поле "База знаний" пусто, `ttsService` будет использовать **Google Search** для поиска информации.
    *   Если пользователь вставляет текст, ИИ будет использовать **только этот текст** как источник фактов. Пользователь также может задавать вопросы по тексту, чтобы дополнить базу знаний.
3.  **Настройка генерации:** Пользователь выбирает между "Творческой свободой" и документальным стилем, а также устанавливает желаемую общую длительность подкаста.
4.  **Запуск проекта:** При нажатии на "Начать проект" запускается основной конвейер генерации.

### 4.2. Конвейер генерации

Процесс создания подкаста состоит из нескольких последовательных шагов, управляемых из `App.tsx`.

1.  **Создание концепции (`generatePodcastBlueprint` в `ttsService.ts`):**
    *   Отправляется сложный промпт к модели `gemini-2.5-pro`.
    *   Промпт включает тему, инструкции по стилю и источнику данных.
    *   Модель возвращает JSON-объект, содержащий: `title`, `description`, `seoKeywords`, `characters`, `imagePrompts` и сценарий первой главы.
    *   Если использовался Google Search, из ответа извлекаются источники (`groundingChunks`).

2.  **Озвучка первой главы (`generatePodcastDialogueAudio` в `ttsService.ts`):**
    *   Сценарий отправляется в модель `gemini-2.5-flash-preview-tts`.
    *   Для каждого персонажа подбирается подходящий голос (`getVoiceForCharacter`) на основе описания (пол, тембр).
    *   API возвращает сырые PCM-аудиоданные, которые на клиенте упаковываются в WAV-файл (`createWavBlobFromPcm`).

3.  **Генерация изображений (`generateStyleImages` в `imageService.ts`):**
    *   10 промптов, созданных на первом шаге, последовательно отправляются в модель `imagen-4.0-generate-001`.
    *   К каждому промпту добавляется суффикс для придания кинематографичности и мистической атмосферы.
    *   API возвращает изображения в формате base64, которые сразу отображаются в интерфейсе.

4.  **Создание обложек (`generateYoutubeThumbnails` в `imageService.ts`):**
    *   Первое сгенерированное изображение используется как фон.
    *   С помощью **Canvas API** создаются 3 варианта обложек с разными стилями текста (шрифт, цвет, тень). Это происходит полностью на клиенте.

5.  **Последовательная генерация остальных глав (цикл в `App.tsx`):**
    *   `App.tsx` отслеживает главы со статусом `pending`.
    *   Для каждой такой главы запускается `handleGenerateChapter`, который:
        *   Вызывает `generateNextChapterScript` для получения сценария следующей главы. В промпт передается краткое содержание предыдущих глав для сохранения контекста.
        *   Вызывает `generatePodcastDialogueAudio` для озвучки полученного сценария.
    *   Этот процесс можно приостановить и возобновить.

### 4.3. Интерфейс "Студии"

После завершения начальной генерации пользователь попадает в основной интерфейс студии, где он может:

*   **Просматривать информацию:** Название, описание, персонажи.
*   **Управлять главами:** Видеть статус каждой главы, прослушивать готовые аудио, инициировать повторную генерацию для неудачных или неудовлетворительных глав.
*   **Работать с визуальными материалами:**
    *   Скачивать сгенерированные изображения.
    *   Редактировать и скачивать обложки для YouTube. Редактор (`ThumbnailEditor.tsx`) позволяет изменять текст, шрифт, размер, цвет, выравнивание, а также параметры тени и перетаскивать текст по холсту.
*   **Получать текстовые материалы:** Копировать готовые тексты (название, описание, ключи) и полный сценарий для ручной озвучки.
*   **Завершить проект:** Когда все главы сгенерированы, становится активной кнопка "Собрать и скачать". Функция `combineWavBlobs` объединяет все аудиофайлы глав в один итоговый WAV-файл.

## 5. Описание ключевых сервисов и утилит

### `services/ttsService.ts`

Это ядро приложения. Он отвечает за:

*   **`generatePodcastBlueprint`:** Создание первоначальной структуры подкаста.
*   **`generateNextChapterScript`:** Генерация сценариев для последующих глав.
*   **`generatePodcastDialogueAudio`:** Преобразование текста в речь с несколькими спикерами.
*   **`researchKnowledgeBase`:** Ответы на вопросы на основе предоставленного текста.
*   **Утилиты для WAV (`createWavBlobFromPcm`, `combineWavBlobs`):** Функции для работы с аудиоформатом WAV, включая создание заголовков и конкатенацию файлов.

### `services/imageService.ts`

Отвечает за всю визуальную составляющую:

*   **`generateStyleImages`:** Взаимодействие с моделью `imagen-4.0-generate-001` для создания набора изображений.
*   **`generateYoutubeThumbnails`:** Оркестрация создания пресетов для обложек с использованием `canvasUtils`.

### `services/canvasUtils.ts`

*   **`drawCanvas`:** Центральная функция, которая рисует на холсте фоновое изображение, накладывает полупрозрачный оверлей и рендерит стилизованный текст с тенями.
*   **`wrapText`:** Утилита для переноса длинного текста на несколько строк, чтобы он помещался в границы обложки.

## 6. Установка и запуск

Приложение является полностью клиентским и не требует серверной части.

1.  **API-ключ:** Для работы приложения необходим API-ключ Google Gemini. Он должен быть установлен в переменной окружения `process.env.API_KEY`. В приложении также предусмотрена возможность для пользователя ввести свой собственный ключ через модальное окно, который будет сохранен в `localStorage`.
2.  **Запуск:** Просто откройте файл `index.html` в современном веб-браузере. Все зависимости (React, @google/genai) подгружаются через CDN, указанный в `importmap`.

## 7. Возможные улучшения

*   **Добавление фоновой музыки и SFX:** Интеграция библиотеки звуковых эффектов и фоновой музыки с возможностью их автоматического или ручного добавления.
*   **Генерация видео:** Использование сгенерированных изображений для создания простого видеоряда (слайд-шоу) под аудиодорожку.
*   **Расширенные настройки голоса:** Предоставление пользователю возможности выбирать голоса для персонажей вручную из списка доступных.
*   **Прямая публикация:** Интеграция с API YouTube или другими подкаст-платформами для прямой загрузки сгенерированного контента.
*   **Улучшение UX:** Добавление более детального прогресса генерации, оценка оставшегося времени.
